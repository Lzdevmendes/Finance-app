rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Regras para usuários - cada usuário só acessa seus próprios dados
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra específica para preferências
    match /users/{userId}/preferences/{document} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Validações adicionais para transações
    match /users/{userId}/transactions/{transactionId} {
      allow read, write: if request.auth != null && request.auth.uid == userId
        && request.resource.data.userId == userId
        && request.resource.data.value is number
        && request.resource.data.value > 0
        && request.resource.data.type in ['income', 'expense']
        && request.resource.data.description is string
        && request.resource.data.description.size() > 0
        && request.resource.data.description.size() <= 100
        && request.resource.data.category is string
        && request.resource.data.date is string;
    }

    // Validações para metas
    match /users/{userId}/goals/{goalId} {
      allow read, write: if request.auth != null && request.auth.uid == userId
        && request.resource.data.userId == userId
        && request.resource.data.name is string
        && request.resource.data.name.size() > 0
        && request.resource.data.name.size() <= 50
        && request.resource.data.targetAmount is number
        && request.resource.data.targetAmount > 0
        && request.resource.data.currentAmount is number
        && request.resource.data.currentAmount >= 0;
    }
  }
}